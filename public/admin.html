<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†ç”»é¢</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #eee; }
        .header { background: white; padding: 20px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .stat-box { background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 20px; }
        
        table { width: 100%; border-collapse: collapse; background: white; }
        th { background: #333; color: white; padding: 10px; }
        td { padding: 10px; border-bottom: 1px solid #ddd; text-align: center; }
        
        .row-checked { background: #e3f2fd; } /* æ¥åº—æ¸ˆ */
        .row-pending { background: #fff3cd; } /* ä¸åœ¨ */
        
        button { cursor: pointer; padding: 8px 12px; border-radius: 4px; border: none; font-weight: bold; color: white; margin: 0 2px; }
        .btn-call { background: #e67e22; }
        .btn-pending { background: #f1c40f; color: #333; }
        .btn-done { background: #2ecc71; }
        .btn-del { background: #95a5a6; font-size: 0.8em; }
        
        .badge { padding: 3px 6px; border-radius: 4px; font-size: 0.8em; color: white; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ç®¡ç†ç”»é¢</h1>
        <div>
            <button class="btn-del" onclick="if(confirm('ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) socket.emit('resetStats')">çµ±è¨ˆãƒªã‚»ãƒƒãƒˆ</button>
            <span id="clock" style="font-weight:bold; font-size:1.2em; margin-left:10px;"></span>
        </div>
    </div>

    <div class="stat-box">
        <div>å¾…ã¡: <b id="qCount" style="font-size:1.5em">0</b> çµ„</div>
        <div>æœ¬æ—¥ç´¯è¨ˆ: <b id="total">0</b></div>
        <div>å¹³å‡å¾…ã¡: <b id="avg">0</b> åˆ†</div>
    </div>

    <table border="0">
        <thead>
            <tr><th>ç•ªå·</th><th>æ™‚é–“</th><th>äººæ•°/å¸­</th><th>çŠ¶æ…‹</th><th>æ“ä½œ</th></tr>
        </thead>
        <tbody id="list"></tbody>
    </table>

    <script>
        const socket = io();
        setInterval(() => document.getElementById('clock').innerText = new Date().toLocaleTimeString(), 1000);

        socket.on('update', d => {
            document.getElementById('qCount').innerText = d.queue.length;
            document.getElementById('total').innerText = d.stats.totalToday;
            document.getElementById('avg').innerText = d.stats.averageWaitTime;

            const list = document.getElementById('list');
            list.innerHTML = d.queue.map(g => {
                let rowClass = '';
                let statusBadge = '';
                
                if (g.status === 'checked-in') {
                    rowClass = 'row-checked';
                    statusBadge = '<span class="badge" style="background:#2196f3">ğŸ“æ¥åº—æ¸ˆ</span>';
                } else if (g.status === 'pending') {
                    rowClass = 'row-pending';
                    statusBadge = '<span class="badge" style="background:#f39c12">âš ï¸ä¸åœ¨</span>';
                }

                return `
                <tr class="${rowClass}">
                    <td style="font-size:1.2em; font-weight:bold; color:#8b0000;">${g.displayId}</td>
                    <td>${g.time}<br><span style="font-size:0.8em; color:#666;">(${Math.floor((Date.now()-g.timestamp)/60000)}åˆ†çµŒé)</span></td>
                    <td>${g.adults}å / ${g.pref}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="btn-call" onclick="socket.emit('callGuest', '${g.displayId}')">å‘¼å‡º</button>
                        <button class="btn-pending" onclick="socket.emit('setPending', '${g.displayId}')">ä¸åœ¨</button>
                        <button class="btn-done" onclick="socket.emit('updateStatus', {displayId:'${g.displayId}', status:'completed'})">å®Œäº†</button>
                        <button class="btn-del" onclick="if(confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) socket.emit('updateStatus', {displayId:'${g.displayId}', status:'delete'})">å‰Šé™¤</button>
                    </td>
                </tr>`;
            }).join('');
        });

        socket.on('init', d => socket.emit('requestUpdate')); // åˆå›æ›´æ–°
    </script>
</body>
</html>
