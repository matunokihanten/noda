<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¾ä¹ƒæœ¨é£¯åº— ç®¡ç†ç”»é¢</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        
        .header { background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); text-align: center; }
        .header h1 { color: #8b0000; font-size: 1.8em; margin-bottom: 10px; }
        .header .clock { font-size: 2em; font-weight: bold; color: #333; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 3px 10px rgba(0,0,0,0.15); text-align: center; }
        .stat-value { font-size: 2.5em; font-weight: bold; color: #8b0000; }
        .stat-label { font-size: 0.9em; color: #666; margin-top: 5px; }
        
        .card { background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .card h2 { color: #8b0000; margin-bottom: 15px; font-size: 1.4em; }
        
        button { cursor: pointer; padding: 10px 18px; border-radius: 8px; border: none; font-weight: bold; transition: all 0.3s; font-size: 0.95em; }
        button:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .btn-stop { background: #e74c3c; color: white; }
        .btn-start { background: #27ae60; color: white; }
        .btn-reset { background: #95a5a6; color: white; }
        .btn-danger { background: #c0392b; color: white; }
        
        #statusLabel { font-weight: bold; font-size: 1.2em; margin-bottom: 15px; padding: 10px; border-radius: 8px; text-align: center; }
        .status-accepting { background: #d4edda; color: #155724; }
        .status-stopped { background: #f8d7da; color: #721c24; }
        
        .controls { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        .controls label { font-weight: bold; margin-right: 10px; }
        
        /* è¨­å®šã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
        .setting-control { background: #e8f4f8; padding: 12px; border-radius: 8px; margin-bottom: 12px; display: flex; align-items: center; justify-content: space-between; gap: 10px; }
        .setting-control input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; }
        .setting-control label { font-size: 1.05em; font-weight: 600; cursor: pointer; flex: 1; }
        .setting-status { font-size: 0.9em; font-weight: bold; padding: 4px 12px; border-radius: 6px; }
        .status-on { background: #27ae60; color: white; }
        .status-off { background: #e74c3c; color: white; }
        
        /* æ–°ã—ã„ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆ6åˆ—ï¼‰ */
        .admin-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        /* ç”»é¢ã‚µã‚¤ã‚ºã«å¿œã˜ãŸè‡ªå‹•æŠ˜ã‚Šè¿”ã— */
        @media (max-width: 1400px) { .admin-grid { grid-template-columns: repeat(4, 1fr); } }
        @media (max-width: 1000px) { .admin-grid { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 768px) { .admin-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 480px) { .admin-grid { grid-template-columns: 1fr; } }

        /* ã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .admin-card {
            background: #fff;
            border: 2px solid #ddd;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .admin-card:hover { transform: translateY(-3px); box-shadow: 0 6px 15px rgba(0,0,0,0.1); }
        .admin-card.arrived { border-color: #27ae60; background: #f0fdf4; }
        .admin-card.called { border-color: #e67e22; background: #fffbeb; }
        .admin-card.absent { border-color: #e74c3c; background: #fef2f2; opacity: 0.8; }
        
        .admin-card-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; padding-bottom: 8px; margin-bottom: 10px; }
        .admin-card-id { font-size: 1.5em; font-weight: bold; color: #8b0000; }
        
        .admin-card-body { font-size: 0.95em; color: #444; line-height: 1.5; flex: 1; }
        .admin-card-body b { font-size: 1.1em; color: #222; }
        
        .admin-card-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-top: 15px; }
        .admin-card-actions button { padding: 8px 4px; font-size: 0.85em; border-radius: 6px; width: 100%; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        
        /* ãƒœã‚¿ãƒ³ã‚«ãƒ©ãƒ¼ */
        .btn-complete { background: #2ecc71; color: white; grid-column: 1 / -1; font-size: 1em !important; padding: 10px !important; }
        .btn-call { background: #e67e22; color: white; }
        .btn-recall { background: #f39c12; color: white; }
        .btn-absent { background: #e74c3c; color: white; }
        .btn-cancel-absent { background: #3498db; color: white; }
        
        .no-data { text-align: center; padding: 40px; color: #999; font-style: italic; border: 2px dashed #ccc; border-radius: 10px; }
        .wait-time { color: #e67e22; font-weight: bold; font-size: 0.9em; }
        .estimated-wait { color: #3498db; font-weight: bold; font-size: 0.9em; margin-top: 5px; }
        
        .type-badge { padding: 4px 8px; border-radius: 5px; font-size: 0.85em; font-weight: bold; color: white; }
        .type-web { background: #9b59b6; }
        .type-shop { background: #3498db; }
        
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 0.85em; font-weight: bold; display: inline-block; margin-top: 5px; }
        .badge-arrived { background: #27ae60; color: white; }
        .badge-called { background: #e67e22; color: white; }
        .badge-absent { background: #e74c3c; color: white; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ® æ¾ä¹ƒæœ¨é£¯åº— ç®¡ç†ç”»é¢</h1>
        <div class="clock" id="clock">--:--:--</div>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-value" id="queueCount">0</div>
            <div class="stat-label">ç¾åœ¨å¾…ã¡çµ„æ•°</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="totalToday">0</div>
            <div class="stat-label">æœ¬æ—¥å—ä»˜ç·æ•°</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="completedToday">0</div>
            <div class="stat-label">æœ¬æ—¥æ¡ˆå†…å®Œäº†</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="avgWait">0</div>
            <div class="stat-label">å¹³å‡å¾…ã¡æ™‚é–“(åˆ†)</div>
        </div>
    </div>

    <div class="card">
        <h2>âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</h2>
        
        <div class="setting-control">
            <input type="checkbox" id="voiceEnabled" onchange="toggleVoice()">
            <label for="voiceEnabled">ğŸ”Š å—ä»˜ç•ªå·ã‚’éŸ³å£°ã§èª­ã¿ä¸Šã’ã‚‹</label>
            <span class="setting-status status-off" id="voiceStatus">OFF</span>
        </div>
        
        <div class="setting-control">
            <input type="checkbox" id="printerEnabled" onchange="togglePrinter()">
            <label for="printerEnabled">ğŸ–¨ï¸ åº—èˆ—å—ä»˜æ™‚ã«ç•ªå·ã‚’å°åˆ·ã™ã‚‹</label>
            <span class="setting-status status-on" id="printerStatus">ON</span>
        </div>
        
        <div class="setting-control">
            <input type="checkbox" id="waitTimeDisplayEnabled" onchange="toggleWaitTimeDisplay()">
            <label for="waitTimeDisplayEnabled">â±ï¸ å¾…ã¡æ™‚é–“ç›®å®‰ã‚’è¡¨ç¤ºã™ã‚‹</label>
            <span class="setting-status status-off" id="waitTimeDisplayStatus">OFF</span>
        </div>
    </div>

    <div class="card">
        <h2>ğŸ“‹ å—ä»˜ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h2>
        
        <div id="statusLabel" class="status-accepting">çŠ¶æ…‹ç¢ºèªä¸­...</div>
        <div class="controls">
            <label>åœæ­¢æ™‚é–“è¨­å®šï¼š</label>
            <button class="btn-stop" onclick="setAccept(false, 0)">ä»Šã™ãåœæ­¢</button>
            <button class="btn-stop" onclick="setAccept(false, 30)">30åˆ†åœæ­¢</button>
            <button class="btn-stop" onclick="setAccept(false, 60)">60åˆ†åœæ­¢</button>
            <button class="btn-start" onclick="setAccept(true, 0)">â–¶ å—ä»˜å†é–‹</button>
            <button class="btn-reset" onclick="resetStats()">ğŸ“Š çµ±è¨ˆãƒªã‚»ãƒƒãƒˆ</button>
            <button class="btn-danger" onclick="resetQueueNumber()">ğŸ”„ ç•ªå·ã‚’1ã«ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
    </div>

    <div class="card">
        <h2>ğŸ‘¥ å¾…ã¡çŠ¶æ³ä¸€è¦§</h2>
        <div id="list" class="admin-grid">
            <div class="no-data" style="grid-column: 1 / -1;">å¾…ã¡å®¢ã¯ã„ã¾ã›ã‚“</div>
        </div>
    </div>

    <script>
        const socket = io();
        let voiceEnabled = localStorage.getItem('voiceEnabled') === 'true';
        let printerEnabled = true;
        // â˜… åˆæœŸå€¤ã®å¾…ã¡æ™‚é–“ç›®å®‰ã‚’éè¡¨ç¤ºã«ã™ã‚‹
        let waitTimeDisplayEnabled = false; 
        
        // æ™‚è¨ˆæ›´æ–°
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('ja-JP', {
                hour: '2-digit', minute: '2-digit', second: '2-digit'
            });
        }
        setInterval(updateClock, 1000);
        updateClock();

        // è¨­å®šã®å¾©å…ƒ
        document.getElementById('voiceEnabled').checked = voiceEnabled;
        updateVoiceStatus();

        function updateVoiceStatus() {
            const status = document.getElementById('voiceStatus');
            if (voiceEnabled) {
                status.textContent = 'ON';
                status.className = 'setting-status status-on';
            } else {
                status.textContent = 'OFF';
                status.className = 'setting-status status-off';
            }
        }

        function updatePrinterStatus() {
            const checkbox = document.getElementById('printerEnabled');
            const status = document.getElementById('printerStatus');
            checkbox.checked = printerEnabled;
            if (printerEnabled) {
                status.textContent = 'ON';
                status.className = 'setting-status status-on';
            } else {
                status.textContent = 'OFF';
                status.className = 'setting-status status-off';
            }
        }

        function updateWaitTimeDisplayStatus() {
            const checkbox = document.getElementById('waitTimeDisplayEnabled');
            const status = document.getElementById('waitTimeDisplayStatus');
            checkbox.checked = waitTimeDisplayEnabled;
            if (waitTimeDisplayEnabled) {
                status.textContent = 'ON';
                status.className = 'setting-status status-on';
            } else {
                status.textContent = 'OFF';
                status.className = 'setting-status status-off';
            }
        }

        function toggleVoice() {
            voiceEnabled = document.getElementById('voiceEnabled').checked;
            localStorage.setItem('voiceEnabled', voiceEnabled);
            updateVoiceStatus();
        }

        function togglePrinter() {
            printerEnabled = document.getElementById('printerEnabled').checked;
            socket.emit('setPrinterEnabled', { enabled: printerEnabled });
        }

        function toggleWaitTimeDisplay() {
            waitTimeDisplayEnabled = document.getElementById('waitTimeDisplayEnabled').checked;
            socket.emit('setWaitTimeDisplay', { enabled: waitTimeDisplayEnabled });
        }

        // éŸ³å£°èª­ã¿ä¸Šã’æ©Ÿèƒ½
        function speakNumber(displayId, name, adults, children, infants) {
            if (!voiceEnabled || !window.speechSynthesis) return;
            
            window.speechSynthesis.cancel();
            
            let text = `${displayId.replace('-', 'ç•ªã€')}`;
            if (name) text += `ã€${name}æ§˜`;
            text += `ã€å¤§äºº${adults}å`;
            if (children > 0) text += `ã€å­ä¾›${children}å`;
            if (infants > 0) text += `ã€å¹¼å…${infants}å`;
            text += `ã€ãŠå‘¼ã³å‡ºã—ã§ã™ã€‚`;
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ja-JP';
            utterance.rate = 0.9; 
            utterance.pitch = 1.0;
            utterance.volume = 1.0;
            
            window.speechSynthesis.speak(utterance);
        }

        // å¾…ã¡æ™‚é–“è¨ˆç®—
        function getWaitTime(timestamp) {
            const now = Date.now();
            const diff = Math.floor((now - timestamp) / 1000 / 60);
            if (diff < 60) return `${diff}åˆ†`;
            const hours = Math.floor(diff / 60);
            const mins = diff % 60;
            return `${hours}æ™‚é–“${mins}åˆ†`;
        }

        // UIæ›´æ–° (ã‚«ãƒ¼ãƒ‰å‹ã‚°ãƒªãƒƒãƒ‰ã«å¤‰æ›´)
        function updateUI(d) {
            const stats = d.stats || {};
            document.getElementById('queueCount').innerText = d.queue ? d.queue.length : 0;
            document.getElementById('totalToday').innerText = stats.totalToday || 0;
            document.getElementById('completedToday').innerText = stats.completedToday || 0;
            document.getElementById('avgWait').innerText = stats.averageWaitTime || 0;

            const list = document.getElementById('list');
            if (!d.queue || d.queue.length === 0) {
                list.innerHTML = '<div class="no-data" style="grid-column: 1 / -1;">å¾…ã¡å®¢ã¯ã„ã¾ã›ã‚“</div>';
            } else {
                list.innerHTML = d.queue.map(g => {
                    const waitTime = getWaitTime(g.timestamp);
                    const estimatedWait = g.estimatedWait ? `ç´„${g.estimatedWait}åˆ†` : '-';
                    const typeLabel = g.type === 'shop' ? 'åº—èˆ—' : 'Web';
                    const typeClass = g.type === 'shop' ? 'type-shop' : 'type-web';
                    const nameDisplay = g.name || 'åå‰ãªã—';
                    
                    let cardClass = '';
                    let statusBadges = '';
                    let actionButtons = '';
                    
                    if (g.arrived) {
                        cardClass = 'arrived';
                        statusBadges += '<span class="status-badge badge-arrived">âœ… åˆ°ç€æ¸ˆã¿</span>';
                    }
                    if (g.called) {
                        cardClass = 'called';
                        statusBadges += '<span class="status-badge badge-called">ğŸ“¢ å‘¼ã³å‡ºã—ä¸­</span>';
                    }
                    if (g.absent) {
                        cardClass = 'absent';
                        statusBadges += '<span class="status-badge badge-absent">âš ï¸ ä¸åœ¨(10åˆ†å¾Œå‰Šé™¤)</span>';
                        actionButtons += `<button class="btn-cancel-absent" onclick="cancelAbsent('${g.displayId}')">ä¸åœ¨è§£é™¤</button>`;
                    } else {
                        actionButtons += `<button class="btn-absent" onclick="markAbsent('${g.displayId}')">ä¸åœ¨</button>`;
                    }
                    
                    if (!g.called) {
                        actionButtons += `<button class="btn-call" onclick="callGuest('${g.displayId}', '${g.name || ''}', ${g.adults}, ${g.children}, ${g.infants})">ğŸ“¢ å‘¼å‡º</button>`;
                    } else {
                        actionButtons += `<button class="btn-recall" onclick="recallGuest('${g.displayId}', '${g.name || ''}', ${g.adults}, ${g.children}, ${g.infants})">ğŸ” å†å‘¼å‡º</button>`;
                    }
                    actionButtons += `<button class="btn-complete" onclick="done('${g.displayId}')">âœ“ æ¡ˆå†…å®Œäº†</button>`;
                    
                    // å¾…ã¡æ™‚é–“ç›®å®‰ã®è¡¨ç¤ºåˆ¶å¾¡
                    let waitTimeHtml = '';
                    if (waitTimeDisplayEnabled && g.estimatedWait) {
                        waitTimeHtml = `<div class="estimated-wait">â±ï¸ ç›®å®‰: ç´„${g.estimatedWait}åˆ†</div>`;
                    }
                    
                    return `
                        <div class="admin-card ${cardClass}">
                            <div class="admin-card-header">
                                <span class="admin-card-id">${g.displayId}</span>
                                <span class="type-badge ${typeClass}">${typeLabel}</span>
                            </div>
                            <div class="admin-card-body">
                                <div style="margin-bottom: 5px;"><b>${nameDisplay}</b> æ§˜</div>
                                <div>ğŸ‘¥ å¤§${g.adults} / å­${g.children} / å¹¼${g.infants}</div>
                                <div>ğŸª‘ ${g.pref}</div>
                                <div style="margin-top: 5px; color: #666;">ğŸ• å—ä»˜: ${g.time}</div>
                                <div class="wait-time">â³ å¾…æ©Ÿ: ${waitTime}</div>
                                ${waitTimeHtml}
                                <div>${statusBadges}</div>
                            </div>
                            <div class="admin-card-actions">
                                ${actionButtons}
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´
        socket.on('statusChange', s => {
            const isAccepting = s.isAccepting !== undefined ? s.isAccepting : s;
            const label = document.getElementById('statusLabel');
            if (isAccepting) {
                label.innerText = "âœ… ç¾åœ¨ï¼šå—ä»˜ä¸­";
                label.className = "status-accepting";
            } else {
                label.innerText = "â¸ï¸ ç¾åœ¨ï¼šå—ä»˜åœæ­¢ä¸­";
                label.className = "status-stopped";
            }
            if (s.queue) {
                updateUI({ queue: s.queue, stats: {} });
            }
        });

        socket.on('init', d => {
            // â˜… ç®¡ç†ç”»é¢ã‚’æ–°è¦ã§é–‹ã„ãŸæ™‚ã€è‡ªå‹•ã§ã‚µãƒ¼ãƒãƒ¼ã®å¾…ã¡æ™‚é–“è¡¨ç¤ºã‚’OFFã«åŒæœŸã•ã›ã‚‹
            if (!sessionStorage.getItem('wait_time_initialized')) {
                socket.emit('setWaitTimeDisplay', { enabled: false });
                waitTimeDisplayEnabled = false;
                sessionStorage.setItem('wait_time_initialized', 'true');
            } else {
                if (d.waitTimeDisplayEnabled !== undefined) {
                    waitTimeDisplayEnabled = d.waitTimeDisplayEnabled;
                }
            }
            
            if (d.printerEnabled !== undefined) {
                printerEnabled = d.printerEnabled;
            }
            
            updatePrinterStatus();
            updateWaitTimeDisplayStatus();
            updateUI(d);
            
            const label = document.getElementById('statusLabel');
            if (d.isAccepting) {
                label.innerText = "âœ… ç¾åœ¨ï¼šå—ä»˜ä¸­";
                label.className = "status-accepting";
            } else {
                label.innerText = "â¸ï¸ ç¾åœ¨ï¼šå—ä»˜åœæ­¢ä¸­";
                label.className = "status-stopped";
            }
        });
        
        socket.on('update', d => updateUI(d));

        socket.on('printerStatusChanged', data => {
            printerEnabled = data.printerEnabled;
            updatePrinterStatus();
        });

        socket.on('waitTimeDisplayChanged', data => {
            waitTimeDisplayEnabled = data.waitTimeDisplayEnabled;
            updateWaitTimeDisplayStatus();
            if (data.queue) {
                updateUI({ queue: data.queue, stats: {} });
            }
        });

        socket.on('queueNumberReset', data => {
            alert(`âœ… å—ä»˜ç•ªå·ã‚’1ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚æ¬¡ã®å—ä»˜ç•ªå·: ${data.nextNumber}`);
        });

        socket.on('guestArrived', data => {
            playSound('info');
        });

        socket.on('dailyReset', () => {
            alert('ğŸ”„ æ—¥æ¬¡ãƒªã‚»ãƒƒãƒˆãŒå®Ÿè¡Œã•ã‚Œã¾ã—ãŸã€‚æ–°ã—ã„1æ—¥ãŒå§‹ã¾ã‚Šã¾ã™ï¼');
            location.reload();
        });

        function done(id) { 
            if (confirm(`${id} ã‚’æ¡ˆå†…å®Œäº†ã«ã—ã¾ã™ã‹ï¼Ÿ`)) {
                socket.emit('updateStatus', { displayId: id, status: 'completed' }); 
            }
        }

        function callGuest(id, name, adults, children, infants) {
            const nameText = name ? `${name}æ§˜ã®` : '';
            if (confirm(`${id} ${nameText}ãŠå®¢æ§˜ã‚’å‘¼ã³å‡ºã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆç›¸æ‰‹ã«é€šçŸ¥ãŒå±Šãã¾ã™ï¼‰`)) {
                socket.emit('callGuest', { displayId: id });
                playSound('call');
                speakNumber(id, name, adults, children, infants);
            }
        }

        function recallGuest(id, name, adults, children, infants) {
            if (confirm(`${id} ã‚’å†åº¦å‘¼ã³å‡ºã—ã¾ã™ã‹ï¼Ÿ`)) {
                socket.emit('callGuest', { displayId: id });
                playSound('call');
                speakNumber(id, name, adults, children, infants);
            }
        }

        function markAbsent(id) {
            if (confirm(`${id} ã‚’ä¸åœ¨ã«ãƒãƒ¼ã‚¯ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆ10åˆ†å¾Œã«è‡ªå‹•å‰Šé™¤ã•ã‚Œã¾ã™ï¼‰`)) {
                socket.emit('markAbsent', { displayId: id });
            }
        }

        function cancelAbsent(id) {
            if (confirm(`${id} ã®ä¸åœ¨ã‚’è§£é™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                socket.emit('cancelAbsent', { displayId: id });
            }
        }
        
        function setAccept(status, duration) { 
            const msg = status 
                ? 'å—ä»˜ã‚’å†é–‹ã—ã¾ã™ã‹ï¼Ÿ' 
                : (duration > 0 ? `${duration}åˆ†é–“å—ä»˜ã‚’åœæ­¢ã—ã¾ã™ã‹ï¼Ÿ` : 'å—ä»˜ã‚’åœæ­¢ã—ã¾ã™ã‹ï¼Ÿ');
            if (confirm(msg)) {
                socket.emit('setAcceptance', { status, duration }); 
            }
        }

        function resetStats() {
            if (confirm('æœ¬æ—¥ã®çµ±è¨ˆã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆå¾…ã¡çŠ¶æ³ã¯ä¿æŒã•ã‚Œã¾ã™ï¼‰')) {
                socket.emit('resetStats');
            }
        }

        function resetQueueNumber() {
            if (confirm('âš ï¸ å—ä»˜ç•ªå·ã‚’1ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\n\næ³¨æ„ï¼šå¾…ã¡å®¢ãŒã„ã‚‹å ´åˆã¯å®Ÿè¡Œã§ãã¾ã›ã‚“ã€‚\nã™ã¹ã¦ã®æ¡ˆå†…ãŒå®Œäº†ã—ã¦ã‹ã‚‰å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚')) {
                socket.emit('resetQueueNumber');
            }
        }

        // ã‚µã‚¦ãƒ³ãƒ‰å†ç”Ÿ
        function playSound(type) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (type === 'call') {
                oscillator.frequency.value = 880;
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } else if (type === 'info') {
                oscillator.frequency.value = 600;
                gainNode.gain.value = 0.2;
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.15);
            }
        }

        socket.on('error', err => {
            alert('ã‚¨ãƒ©ãƒ¼: ' + err.message);
        });
    </script>
</body>
</html>
