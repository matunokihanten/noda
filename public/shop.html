<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åº—èˆ—å—ä»˜</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: sans-serif; background: #2c3e50; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        header { background: #8b0000; color: white; padding: 10px; text-align: center; }
        
        .main { display: flex; flex: 1; padding: 10px; gap: 10px; height: 100%; }
        
        /* å·¦ãƒ‘ãƒãƒ«ï¼šå…¥åŠ› */
        .left { flex: 0 0 450px; display: flex; flex-direction: column; gap: 10px; }
        .panel { background: white; border-radius: 10px; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        
        /* å³ãƒ‘ãƒãƒ«ï¼šãƒªã‚¹ãƒˆ */
        .right { flex: 1; background: rgba(255,255,255,0.1); border-radius: 10px; padding: 10px; overflow-y: auto; }
        
        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
        .row { display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 10px; }
        .btn-circle { width: 50px; height: 50px; border-radius: 50%; border: 1px solid #ccc; font-size: 1.5em; background: #eee; cursor: pointer; }
        .num { font-size: 2em; font-weight: bold; width: 60px; text-align: center; }
        
        /* åº§å¸­ãƒœã‚¿ãƒ³ */
        .seat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 10px 0; }
        .seat-btn { padding: 15px; border: 2px solid #ddd; border-radius: 8px; background: #f9f9f9; font-size: 1.1em; font-weight: bold; cursor: pointer; }
        .seat-btn.active { background: #8b0000; color: white; border-color: #8b0000; }
        
        .btn-big { width: 100%; padding: 15px; background: #27ae60; color: white; font-size: 1.5em; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px; }

        /* ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ  */
        .q-item { background: white; padding: 10px; margin-bottom: 5px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; }
        .q-id { font-size: 1.4em; font-weight: bold; color: #8b0000; }
    </style>
</head>
<body>
    <header><h1>ğŸ® æ¾ä¹ƒæœ¨é£¯åº— åº—èˆ—å—ä»˜</h1></header>
    <div class="main">
        <div class="left">
            <div id="inputForm" class="panel">
                <div style="text-align:center; margin-bottom:5px;">å¤§äºº</div>
                <div class="row">
                    <button class="btn-circle" onclick="nums.adults=Math.max(1,nums.adults-1);upd()">-</button>
                    <span id="d_adults" class="num">2</span>
                    <button class="btn-circle" onclick="nums.adults++;upd()">+</button>
                </div>
                
                <div style="text-align:center; margin-bottom:5px;">å­ä¾›</div>
                <div class="row">
                    <button class="btn-circle" onclick="nums.children=Math.max(0,nums.children-1);upd()">-</button>
                    <span id="d_children" class="num">0</span>
                    <button class="btn-circle" onclick="nums.children++;upd()">+</button>
                </div>

                <div class="seat-grid">
                    <button class="seat-btn active" onclick="selSeat(this, 'ã©ã“ã§ã‚‚')">ã©ã“ã§ã‚‚</button>
                    <button class="seat-btn" onclick="selSeat(this, 'ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼')">ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼</button>
                    <button class="seat-btn" onclick="selSeat(this, 'ãƒ†ãƒ¼ãƒ–ãƒ«')">ãƒ†ãƒ¼ãƒ–ãƒ«</button>
                    <button class="seat-btn" onclick="selSeat(this, 'ãŠåº§æ•·')">ãŠåº§æ•·</button>
                </div>

                <button class="btn-big" onclick="send()">ç™ºåˆ¸ã™ã‚‹</button>
            </div>

            <div id="ticketView" class="panel" style="display:none; text-align:center; padding:30px;">
                <div style="font-size:1.2em;">å—ä»˜ç•ªå·</div>
                <div id="resNum" style="font-size:5em; font-weight:bold; color:#8b0000; margin:20px 0;">--</div>
                <button class="btn-big" style="background:#7f8c8d" onclick="resetForm()">æ¬¡ã®æ–¹ã¸</button>
            </div>
        </div>

        <div class="right">
            <h3 style="color:white; text-align:center;">å¾…ã¡çŠ¶æ³</h3>
            <div id="list"></div>
        </div>
    </div>

    <script>
        const socket = io();
        let nums = { adults: 2, children: 0 };
        let seat = 'ã©ã“ã§ã‚‚';

        function upd() { 
            document.getElementById('d_adults').innerText = nums.adults;
            document.getElementById('d_children').innerText = nums.children;
        }

        function selSeat(btn, val) {
            document.querySelectorAll('.seat-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            seat = val;
        }

        function send() {
            socket.emit('register', { type: 'shop', ...nums, infants:0, pref: seat });
            playLongChime(); // é•·ã„éŸ³ã‚’é³´ã‚‰ã™
        }

        function resetForm() {
            document.getElementById('inputForm').style.display='block';
            document.getElementById('ticketView').style.display='none';
            nums = { adults: 2, children: 0 };
            selSeat(document.querySelectorAll('.seat-btn')[0], 'ã©ã“ã§ã‚‚');
            upd();
        }

        socket.on('registered', g => {
            if(g.type === 'shop') {
                document.getElementById('inputForm').style.display='none';
                document.getElementById('ticketView').style.display='block';
                document.getElementById('resNum').innerText = g.displayId;
            }
        });

        socket.on('update', d => {
            document.getElementById('list').innerHTML = d.queue.map(g => `
                <div class="q-item">
                    <span class="q-id">${g.displayId}</span>
                    <span>${g.adults+g.children}å / ${g.pref}</span>
                </div>
            `).join('');
        });

        // 2ç§’é–“é³´ã‚‹ãƒãƒ£ã‚¤ãƒ ï¼ˆãƒ”ãƒ»ãƒ”ãƒ»ãƒ”ãƒ»ãƒ”ï¼‰
        function playLongChime() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                [0, 0.5, 1.0, 1.5].forEach(t => {
                    const osc = ctx.createOscillator();
                    const g = ctx.createGain();
                    osc.connect(g); g.connect(ctx.destination);
                    osc.frequency.value = 880; 
                    g.gain.setValueAtTime(0.2, ctx.currentTime + t);
                    g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + t + 0.3);
                    osc.start(ctx.currentTime + t);
                    osc.stop(ctx.currentTime + t + 0.3);
                });
            } catch(e) {}
        }
    </script>
</body>
</html>
