<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¾ä¹ƒæœ¨é£¯åº— - å—ä»˜ç™ºåˆ¸æ©Ÿ</title>
    <style>
        /* ã‚¹ãƒãƒ›ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆå‘ã‘ã®ãƒªã‚»ãƒƒãƒˆã¨åŸºæœ¬è¨­å®š */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
            background: linear-gradient(135deg, #fdfaf5 0%, #fff8f0 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            text-align: center;
        }
        .container {
            background: white;
            padding: 40px 20px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 3px solid #d4b483;
            width: 90%;
            max-width: 500px;
        }
        h1 {
            color: #8b0000;
            font-size: 2em;
            margin-bottom: 10px;
        }
        p.subtitle {
            color: #666;
            font-size: 1.1em;
            margin-bottom: 40px;
        }
        
        /* ç™ºåˆ¸ãƒœã‚¿ãƒ³ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .btn-print {
            background: linear-gradient(135deg, #8b0000 0%, #b91d1d 100%);
            color: white;
            border: none;
            padding: 30px 20px;
            width: 100%;
            font-size: 1.8em;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(139, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        .btn-print:active {
            transform: translateY(4px);
            box-shadow: 0 4px 10px rgba(139, 0, 0, 0.2);
        }
        .btn-print:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        
        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        #statusMessage {
            margin-top: 25px;
            font-size: 1.2em;
            font-weight: bold;
            min-height: 1.5em;
        }
        .success { color: #27ae60; }
        .error { color: #e74c3c; }
        .processing { color: #e67e22; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ® æ¾ä¹ƒæœ¨é£¯åº—</h1>
        <p class="subtitle">é †ç•ªå¾…ã¡å—ä»˜æ©Ÿ</p>

        <button id="printBtn" class="btn-print" onclick="issueTicket()">
            <span>ğŸ« å—ä»˜ç¥¨ã‚’ç™ºåˆ¸ã™ã‚‹</span>
        </button>

        <div id="statusMessage"></div>
    </div>

    <script>
        // ç™ºåˆ¸å‡¦ç†ã‚’è¡Œã†é–¢æ•°
        async function issueTicket() {
            const btn = document.getElementById('printBtn');
            const status = document.getElementById('statusMessage');

            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ã—ã€çŠ¶æ…‹ã‚’æ›´æ–°
            btn.disabled = true;
            status.className = 'processing';
            status.innerText = 'â³ ç™ºåˆ¸ä¸­...';

            try {
                // cloudprnt.php ã« GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
                const response = await fetch('cloudprnt.php?action=queue');
                const text = await response.text();

                if (response.ok && text.trim() === 'OK') {
                    status.className = 'success';
                    status.innerText = 'âœ… ç™ºåˆ¸ã—ã¾ã—ãŸï¼ç•ªå·æœ­ã‚’ãŠå–ã‚Šãã ã•ã„ã€‚';
                } else {
                    throw new Error('ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
                }
            } catch (error) {
                console.error(error);
                status.className = 'error';
                status.innerText = 'âŒ ç™ºåˆ¸ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚¹ã‚¿ãƒƒãƒ•ã‚’ãŠå‘¼ã³ãã ã•ã„ã€‚';
            } finally {
                // 3ç§’å¾Œã«ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã—ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¶ˆã™
                setTimeout(() => {
                    btn.disabled = false;
                    status.innerText = '';
                }, 3000);
            }
        }
    </script>
</body>
</html>